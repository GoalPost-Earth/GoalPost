# GoalPost ReAct Agent - Architecture Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Interface                           â”‚
â”‚                  (src/components/assistant-ui/)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   Thread   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ EnhancedMessage  â”‚                    â”‚
â”‚  â”‚            â”‚        â”‚      Text        â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â”‚                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                        â”‚                â”‚                        â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                  â”‚ PersonCard â”‚  â”‚ MarkdownTextâ”‚               â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ User Message
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Chat API Route                              â”‚
â”‚                  (src/app/api/chat/route.ts)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚           AI SDK streamText()                       â”‚        â”‚
â”‚  â”‚                                                      â”‚        â”‚
â”‚  â”‚  Tools:                                             â”‚        â”‚
â”‚  â”‚  â”œâ”€ search_person                                   â”‚        â”‚
â”‚  â”‚  â”œâ”€ search_community                                â”‚        â”‚
â”‚  â”‚  â””â”€ frontendTools()                                 â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                      â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Guardrails Layer                              â”‚
â”‚              (src/lib/simulation/guardrails.ts)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  validateQuery()                                 â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚
â”‚  â”‚  â”‚  OpenAI LLM Classification               â”‚  â”‚           â”‚
â”‚  â”‚  â”‚                                           â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  Positive Examples:                       â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  - "Who is John Smith?"        âœ“         â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  - "What communities exist?"   âœ“         â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  - "How does GoalPost work?"   âœ“         â”‚  â”‚           â”‚
â”‚  â”‚  â”‚                                           â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  Negative Examples:                       â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  - "What's the weather?"       âœ—         â”‚  â”‚           â”‚
â”‚  â”‚  â”‚  - "Tell me a joke"            âœ—         â”‚  â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ If ALLOWED
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tool Execution Layer                          â”‚
â”‚         (src/modules/agent/tools/person-search.tool.ts)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  search_person_by_name(name)                       â”‚        â”‚
â”‚  â”‚                                                      â”‚        â”‚
â”‚  â”‚  Cypher Query:                                      â”‚        â”‚
â”‚  â”‚  MATCH (p:Person)                                   â”‚        â”‚
â”‚  â”‚  WHERE toLower(p.firstName) CONTAINS name           â”‚        â”‚
â”‚  â”‚     OR toLower(p.lastName) CONTAINS name            â”‚        â”‚
â”‚  â”‚  OPTIONAL MATCH (p)-[:BELONGS_TO]->(c:Community)   â”‚        â”‚
â”‚  â”‚  OPTIONAL MATCH (p)-[:CONNECTED_TO]-(conn:Person)  â”‚        â”‚
â”‚  â”‚  RETURN p, communities, connectionCount             â”‚        â”‚
â”‚  â”‚                                                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                      â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Neo4j Database                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Graph Schema:                                                   â”‚
â”‚                                                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚     â”‚ Person  â”‚                                                 â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                 â”‚
â”‚     â”‚firstNameâ”‚                                                 â”‚
â”‚     â”‚lastName â”‚                                                 â”‚
â”‚     â”‚email    â”‚                                                 â”‚
â”‚     â”‚pronouns â”‚                                                 â”‚
â”‚     â”‚passions â”‚                                                 â”‚
â”‚     â”‚interestsâ”‚                                                 â”‚
â”‚     â”‚traits   â”‚â”€â”€â”€â”€â”€BELONGS_TOâ”€â”€â”€â”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚     â”‚...      â”‚                     â”‚ Community â”‚              â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€CONNECTED_TOâ”€â–¶â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                          â”‚ Person  â”‚                            â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Query Results
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Response Processing                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Case 1: No Match (results.length === 0)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚  Response: "I searched the database but could not find..."      â”‚
â”‚                                                                  â”‚
â”‚  Case 2: Disambiguation (results.length > 1)                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚  Response: "I found 3 people:                                   â”‚
â”‚             1. John Smith - Seattle (Tech)                      â”‚
â”‚             2. John Doe - he/him (Arts)                         â”‚
â”‚             3. John Williams - NYC                              â”‚
â”‚             Could you clarify?"                                 â”‚
â”‚                                                                  â”‚
â”‚  Case 3: Found (results.length === 1)                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚  Response: "PERSON_PROFILE_FOUND: {                             â”‚
â”‚              id: '123',                                          â”‚
â”‚              firstName: 'Sarah',                                 â”‚
â”‚              lastName: 'Johnson',                                â”‚
â”‚              passions: 'Social Justice, Education',              â”‚
â”‚              communities: ['Education Reform'],                  â”‚
â”‚              ...                                                 â”‚
â”‚            }"                                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Stream Response
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UI Rendering                                  â”‚
â”‚         (src/components/assistant-ui/enhanced-message-text.tsx)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Parse response for markers:                                     â”‚
â”‚                                                                  â”‚
â”‚  If "PERSON_PROFILE_FOUND:" detected:                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚         Extract JSON                        â”‚                â”‚
â”‚  â”‚              â”‚                               â”‚                â”‚
â”‚  â”‚              â–¼                               â”‚                â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                â”‚
â”‚  â”‚  â”‚      PersonCard          â”‚              â”‚                â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚                â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  â”‚ Avatar â”‚  Sarah J     â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  she/her     â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  ğŸ“ San Francisco        â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  âœ‰ï¸  sarah@example.com   â”‚              â”‚                â”‚
â”‚  â”‚  â”‚                          â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  Communities:            â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  ğŸ”µ Education Reform     â”‚              â”‚                â”‚
â”‚  â”‚  â”‚                          â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  Passions:               â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  ğŸ”´ Social Justice       â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  ğŸ”´ Education            â”‚              â”‚                â”‚
â”‚  â”‚  â”‚                          â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  Interests:              â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  ğŸ’™ Community Organizing â”‚              â”‚                â”‚
â”‚  â”‚  â”‚  ğŸ’™ Poetry               â”‚              â”‚                â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â”‚  Else:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚       Render as MarkdownText                â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Sequence

```
1. User Types Message
   â””â”€â–¶ "Tell me about Sarah Johnson"

2. AI SDK streamText
   â””â”€â–¶ Determines relevant tool: search_person

3. Guardrails Validation
   â”œâ”€â–¶ LLM classifies: "ALLOWED" âœ“
   â””â”€â–¶ Proceeds to tool execution

4. Tool Execution
   â”œâ”€â–¶ createPersonSearchTool({ name: "Sarah Johnson" })
   â””â”€â–¶ Cypher query to Neo4j

5. Neo4j Query
   â”œâ”€â–¶ MATCH (p:Person) WHERE name matches
   â””â”€â–¶ Returns: [{ firstName: "Sarah", lastName: "Johnson", ... }]

6. Response Processing
   â”œâ”€â–¶ 1 match found
   â”œâ”€â–¶ Generate: "PERSON_PROFILE_FOUND: {...}"
   â””â”€â–¶ Stream back to client

7. UI Parsing
   â”œâ”€â–¶ EnhancedMessageText detects marker
   â”œâ”€â–¶ Extracts JSON profile data
   â””â”€â–¶ Renders PersonCard component

8. User Sees
   â””â”€â–¶ Beautiful profile card with all details
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Thread    â”‚ Main chat interface
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ renders messages
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EnhancedMessageText â”‚ Detects special markers
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚      â”‚
       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                    â”‚
       â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PersonCard â”‚      â”‚ MarkdownText â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Shows profile       Shows normal text
```

## Error Handling Flow

```
User Query
    â”‚
    â”œâ”€â–¶ Guardrails REJECT
    â”‚   â””â”€â–¶ Return rejection message
    â”‚       â””â”€â–¶ Display in chat
    â”‚
    â”œâ”€â–¶ Neo4j Connection Error
    â”‚   â””â”€â–¶ Catch error
    â”‚       â””â”€â–¶ Return "Error searching..."
    â”‚           â””â”€â–¶ Display in chat
    â”‚
    â”œâ”€â–¶ Person Not Found
    â”‚   â””â”€â–¶ Return "No information in database"
    â”‚       â””â”€â–¶ Display in chat
    â”‚
    â””â”€â–¶ JSON Parse Error
        â””â”€â–¶ Fallback to text display
            â””â”€â–¶ Log error to console
```

## Technology Stack

```
Frontend:
â”œâ”€ React 18
â”œâ”€ TypeScript
â”œâ”€ Tailwind CSS
â”œâ”€ assistant-ui
â”œâ”€ shadcn/ui components
â””â”€ AI SDK

Backend:
â”œâ”€ Next.js 15 API Routes
â”œâ”€ LangChain
â”œâ”€ OpenAI API
â””â”€ Ollama (Mistral)

Database:
â””â”€ Neo4j Graph Database

Agent Framework:
â”œâ”€ ReAct Pattern
â”œâ”€ OpenAI Functions Agent
â”œâ”€ DynamicStructuredTool
â””â”€ BufferMemory
```

## File Dependencies

```
thread.tsx
  â”‚
  â””â”€â–¶ enhanced-message-text.tsx
       â”œâ”€â–¶ person-card.tsx
       â”‚    â””â”€â–¶ ui/card.tsx
       â”‚    â””â”€â–¶ ui/avatar.tsx
       â”‚
       â””â”€â–¶ markdown-text.tsx

route.ts
  â”‚
  â”œâ”€â–¶ guardrails.ts
  â”‚    â””â”€â–¶ OpenAI API
  â”‚
  â””â”€â–¶ person-search.tool.ts
       â””â”€â–¶ Neo4j Graph

react-agent.ts
  â”œâ”€â–¶ person-search.tool.ts
  â”œâ”€â–¶ tools/index.ts
  â”‚    â”œâ”€â–¶ cypher-retrieval.chain.ts
  â”‚    â””â”€â–¶ vector-retrieval.chain.ts
  â”‚
  â””â”€â–¶ guardrails.ts
```

---

**Legend:**
- `â”€â–¶` : Data flow
- `â”œâ”€` : Branch
- `â””â”€` : End of branch
- `âœ“` : Allowed/Success
- `âœ—` : Blocked/Error
- `ğŸ”µ` : Community tag
- `ğŸ”´` : Passion tag
- `ğŸ’™` : Interest tag

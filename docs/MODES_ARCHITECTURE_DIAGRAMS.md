# Multi-Mode Assistant - Architecture Diagram

## System Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE LAYER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Chat Component                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ AssistantModeSelector (Dropdown)                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ Standard â”‚ â”‚  Aiden   â”‚ â”‚ Braider  â”‚                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â”‚   ğŸ”     â”‚ â”‚   â“     â”‚ â”‚   ğŸ§µ    â”‚                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                           â†“ (mode selected)                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Chat Messages Display                                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ (Shows AssistantModeIndicator with current mode)           â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                           â†“ (user sends message + mode)          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Input Field                                                â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ + Send Button                                              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                                 â”‚
                   â–¼                                 â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ POST Request Body  â”‚         â”‚ GET /api/...       â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ {                   â”‚         â”‚ ?mode=aiden         â”‚
         â”‚   messages: [...],  â”‚         â”‚ (to switch mode)    â”‚
         â”‚   mode: 'aiden',    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚   config: {...}     â”‚
         â”‚ }                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚          API LAYER                                    â”‚
       â”‚  POST /api/chat/simulation                            â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                      â”‚
       â–¼                                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   extractModeFromRequest()       â”‚      â”‚  buildMessagePayload()       â”‚
â”‚                                  â”‚      â”‚  (Legacy support)            â”‚
â”‚  Extract mode: 'aiden'           â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                  â”‚
â”‚  if mode provided:               â”‚
â”‚    assistantModeManager          â”‚
â”‚      .setMode('aiden')           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            State Management Layer                           â”‚
â”‚                                                             â”‚
â”‚  assistantModeManager (Singleton - Dev/Demo)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ getMode() â†’ 'aiden'                                   â”‚ â”‚
â”‚  â”‚ setMode('aiden') â†’ sets state                         â”‚ â”‚
â”‚  â”‚ getState() â†’ { mode, messageCount, activatedAt }      â”‚ â”‚
â”‚  â”‚ incrementMessageCount()                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  (For production: replace with session/JWT or DB)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Configuration Selection Layer                       â”‚
â”‚                                                             â”‚
â”‚  const systemPrompt = SYSTEM_PROMPTS[mode]                 â”‚
â”‚                                                             â”‚
â”‚  SYSTEM_PROMPTS = {                                         â”‚
â”‚    default: "You are GoalPost Assistant...",               â”‚
â”‚    aiden: "You are Aiden, designed to question...",        â”‚
â”‚    braider: "You are Braider, designed to stay..."         â”‚
â”‚  }                                                          â”‚
â”‚                                                             â”‚
â”‚  MODE_METADATA = {                                          â”‚
â”‚    default: { label: 'Standard', icon: 'ğŸ”', ... },        â”‚
â”‚    aiden: { label: 'Aiden', icon: 'â“', ... },             â”‚
â”‚    braider: { label: 'Braider', icon: 'ğŸ§µ', ... }          â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LLM Integration Layer                          â”‚
â”‚                                                             â”‚
â”‚  streamText({                                               â”‚
â”‚    model: openai('gpt-4o-mini'),                            â”‚
â”‚    messages: [...],                                         â”‚
â”‚    system: systemPrompt,  â† Different per mode              â”‚
â”‚    tools: {                                                 â”‚
â”‚      search_person: tool({...}),                            â”‚
â”‚      search_community: tool({...})                          â”‚
â”‚    }                                                        â”‚
â”‚  })                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tool Execution      â”‚     â”‚  LLM Response          â”‚
â”‚                      â”‚     â”‚                        â”‚
â”‚  search_person       â”‚     â”‚  Different tone        â”‚
â”‚  search_community    â”‚     â”‚  based on system       â”‚
â”‚                      â”‚     â”‚  prompt (mode)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Response Stream                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Response Headers:                                    â”‚ â”‚
â”‚  â”‚  X-Assistant-Mode: aiden                              â”‚ â”‚
â”‚  â”‚  Content-Type: text/event-stream                      â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  Response Body:                                       â”‚ â”‚
â”‚  â”‚  <streamed response in Aiden's voice>                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Browser/Client processes stream        â”‚
       â”‚  Updates UI with response               â”‚
       â”‚  Shows AssistantModeIndicator           â”‚
       â”‚  Displays current mode to user          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure & Dependencies

```
src/lib/simulation/
â”‚
â”œâ”€â”€ system-prompts.ts                    â† SINGLE SOURCE OF TRUTH
â”‚   â”œâ”€â”€ SYSTEM_PROMPTS (object)
â”‚   â”‚   â”œâ”€â”€ default: string
â”‚   â”‚   â”œâ”€â”€ aiden: string
â”‚   â”‚   â””â”€â”€ braider: string
â”‚   â”œâ”€â”€ MODE_METADATA (object)
â”‚   â”‚   â”œâ”€â”€ default: { label, description, icon, category }
â”‚   â”‚   â”œâ”€â”€ aiden: { label, description, icon, category }
â”‚   â”‚   â””â”€â”€ braider: { label, description, icon, category }
â”‚   â”œâ”€â”€ SystemPromptKey: type
â”‚   â””â”€â”€ AssistantModeInfo: type
â”‚
â”œâ”€â”€ types.ts                             â† Type Definitions
â”‚   â”œâ”€â”€ AssistantMode: 'default' | 'aiden' | 'braider'
â”‚   â”œâ”€â”€ SimulationState: interface
â”‚   â”œâ”€â”€ ChatMessage: interface
â”‚   â””â”€â”€ SimulationConfig: interface
â”‚
â”œâ”€â”€ state.ts                             â† State Management
â”‚   â”œâ”€â”€ AssistantModeManager: class
â”‚   â”‚   â”œâ”€â”€ getMode()
â”‚   â”‚   â”œâ”€â”€ setMode()
â”‚   â”‚   â”œâ”€â”€ reset()
â”‚   â”‚   â”œâ”€â”€ getState()
â”‚   â”‚   â”œâ”€â”€ isNonDefault()
â”‚   â”‚   â””â”€â”€ isModeActive()
â”‚   â””â”€â”€ assistantModeManager: singleton instance
â”‚
â”œâ”€â”€ index.ts                             â† Central Export
â”‚   â”œâ”€â”€ export { assistantModeManager }
â”‚   â”œâ”€â”€ export { SYSTEM_PROMPTS, MODE_METADATA }
â”‚   â””â”€â”€ export type { AssistantMode, ... }
â”‚
â””â”€â”€ [other files: helpers.ts, protocol.ts, middleware.ts]

src/app/api/chat/simulation/route.ts     â† API Endpoint
â”‚   â”œâ”€â”€ POST handler:
â”‚   â”‚   â”œâ”€â”€ Extract mode from request body
â”‚   â”‚   â”œâ”€â”€ Set mode via assistantModeManager.setMode()
â”‚   â”‚   â”œâ”€â”€ Select system prompt via SYSTEM_PROMPTS[mode]
â”‚   â”‚   â”œâ”€â”€ Stream response with selected prompt
â”‚   â”‚   â””â”€â”€ Return X-Assistant-Mode header
â”‚   â”‚
â”‚   â””â”€â”€ GET handler:
â”‚       â”œâ”€â”€ Support ?mode=aiden query param
â”‚       â””â”€â”€ Return current state

src/components/chat/assistant-mode-selector.tsx  â† UI Components
â”‚   â”œâ”€â”€ AssistantModeSelector: component
â”‚   â”‚   â”œâ”€â”€ Props: currentMode, onModeChange, disabled
â”‚   â”‚   â””â”€â”€ Renders: <Select> with all modes
â”‚   â”‚
â”‚   â”œâ”€â”€ AssistantModeIndicator: component
â”‚   â”‚   â”œâ”€â”€ Props: mode, showLabel
â”‚   â”‚   â””â”€â”€ Renders: Badge showing current mode
â”‚   â”‚
â”‚   â””â”€â”€ AssistantModeInfo: component
â”‚       â”œâ”€â”€ No props
â”‚       â””â”€â”€ Renders: Help panel explaining modes
```

## Data Flow: User Perspective

```
1. USER SELECTS MODE
   â”‚
   â”œâ”€ Clicks dropdown selector
   â”œâ”€ Sees: Standard (ğŸ”), Aiden (â“), Braider (ğŸ§µ)
   â”œâ”€ Selects: "Aiden"
   â”‚
   â””â”€> AssistantModeSelector.onModeChange('aiden')
       â””â”€> UI updates to show "Aiden" indicator
           â””â”€> Mode stored (localStorage or state)

2. USER TYPES MESSAGE
   â”‚
   â”œâ”€ Types: "But what assumptions are we making here?"
   â”œâ”€ Presses Enter
   â”‚
   â””â”€> Message + mode sent to API
       POST /api/chat/simulation
       {
         messages: [{ role: 'user', content: '...' }],
         mode: 'aiden',         â† â† â† KEY!
         config: { model: '...' }
       }

3. API PROCESSES REQUEST
   â”‚
   â”œâ”€ Route handler receives request
   â”œâ”€ Extracts: mode = 'aiden'
   â”œâ”€ Calls: assistantModeManager.setMode('aiden')
   â”œâ”€ Fetches: systemPrompt = SYSTEM_PROMPTS['aiden']
   â”‚
   â””â”€> Sends to OpenAI:
       {
         system: "You are Aiden, designed to question..."
         messages: [...]
         tools: { search_person, search_community }
       }

4. OPENAI RESPONDS
   â”‚
   â”œâ”€ Receives system prompt (Aiden mode)
   â”œâ”€ Generates response in Aiden's voice:
   â”‚  "What assumptions shape your question? Are we assuming..."
   â”‚
   â””â”€> Streams back to client

5. CLIENT RECEIVES & DISPLAYS
   â”‚
   â”œâ”€ Browser receives streaming response
   â”œâ”€ Displays response in chat
   â”œâ”€ Shows mode indicator: "â“ Aiden"
   â”‚
   â””â”€> User sees assistant responding in Aiden's style
```

## Mode Selection Decision Tree

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  User's Question    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              â”‚              â”‚
                â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ "Tell me about â”‚ â”‚ "Why do we   â”‚ â”‚ "I'm really  â”‚
        â”‚  Alice"        â”‚ â”‚  assume..."  â”‚ â”‚  burnt out"  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                â”‚                â”‚
       [Database lookup]  [Philosophical]   [Emotional support]
                 â”‚                â”‚                â”‚
                 â–¼                â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Standard Mode  â”‚ â”‚  Aiden Mode  â”‚ â”‚ Braider Mode â”‚
        â”‚  ğŸ”           â”‚ â”‚  â“          â”‚ â”‚  ğŸ§µ         â”‚
        â”‚                â”‚ â”‚              â”‚ â”‚              â”‚
        â”‚ "Alice is in   â”‚ â”‚ "Let's       â”‚ â”‚ "What you're â”‚
        â”‚  Sales..."     â”‚ â”‚  examine the â”‚ â”‚  describing  â”‚
        â”‚                â”‚ â”‚  frames we   â”‚ â”‚  matters. Letâ”‚
        â”‚ Direct facts   â”‚ â”‚  hold..."    â”‚ â”‚  me stay withâ”‚
        â”‚ from database  â”‚ â”‚              â”‚ â”‚  you..."     â”‚
        â”‚                â”‚ â”‚ Questions    â”‚ â”‚              â”‚
        â”‚ Tool behavior: â”‚ â”‚ assumptions  â”‚ â”‚ Presence &   â”‚
        â”‚ Call tools     â”‚ â”‚              â”‚ â”‚ reflection   â”‚
        â”‚ when asked     â”‚ â”‚ Tool behaviorâ”‚ â”‚              â”‚
        â”‚                â”‚ â”‚ Uses data to â”‚ â”‚ Tool behaviorâ”‚
        â”‚                â”‚ â”‚ explore      â”‚ â”‚ Grounds in   â”‚
        â”‚                â”‚ â”‚              â”‚ â”‚ real stories â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Management: Singleton vs. Production

```
CURRENT (Dev/Demo):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Server Memory Singleton       â”‚
â”‚  assistantModeManager {         â”‚
â”‚    mode: 'aiden',               â”‚
â”‚    messageCount: 42,            â”‚
â”‚    activatedAt: Date            â”‚
â”‚  }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (Shared across all clients in dev)
    â””â”€ âš ï¸ Resets on server restart
    â””â”€ âš ï¸ Not safe for multi-user

PRODUCTION OPTIONS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Session/JWT Token             â”‚
â”‚  jwt.payload = {                â”‚
â”‚    ...auth,                     â”‚
â”‚    mode: 'aiden'                â”‚
â”‚  }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (Per-user, survives server restart)
    âœ“ Works with stateless deployment
    âœ“ Scales horizontally

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Database                 â”‚
â”‚  users table:                   â”‚
â”‚    id, email, ..., preferredModeâ”‚
â”‚    'user1', ..., 'aiden'        â”‚
â”‚    'user2', ..., 'default'      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (Persistent user preference)
    âœ“ Survives logout/login
    âœ“ Works across devices

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client LocalStorage            â”‚
â”‚  localStorage = {               â”‚
â”‚    assistantMode: 'aiden'       â”‚
â”‚  }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ (Browser-local)
    âœ“ Instant, no server call
    âœ“ Works offline
    âœ— Not synced across tabs/devices
```

## Request/Response Cycle

```
CLIENT REQUEST:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/chat/simulation                           â”‚
â”‚ {                                                   â”‚
â”‚   "messages": [                                     â”‚
â”‚     { "role": "user", "content": "Tell me about..." â”‚
â”‚   ],                                                â”‚
â”‚   "mode": "aiden",          â† NEW!                  â”‚
â”‚   "config": {                                       â”‚
â”‚     "model": "gpt-4o-mini",                         â”‚
â”‚     "stream": true                                  â”‚
â”‚   }                                                 â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    [BACKEND PROCESSING]
                           â†“
API RESPONSE (HEADERS):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP/1.1 200 OK                                     â”‚
â”‚ Content-Type: text/event-stream                     â”‚
â”‚ X-Assistant-Mode: aiden              â† NEW!         â”‚
â”‚ Transfer-Encoding: chunked                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
API RESPONSE (BODY):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0: "{"                                              â”‚
â”‚ 1: "type": "text-delta"                             â”‚
â”‚ 2: "delta": "What assumptions are you making"       â”‚
â”‚ 3: " when you ask that question?"                   â”‚
â”‚ ...                                                 â”‚
â”‚ n: "}                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Composition

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Your Chat Component                        â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Header                                         â”‚ â”‚
â”‚  â”‚  <h1>GoalPost</h1>                             â”‚ â”‚
â”‚  â”‚  <AssistantModeIndicator mode="aiden" />      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Control Panel                                  â”‚ â”‚
â”‚  â”‚  <AssistantModeSelector                        â”‚ â”‚
â”‚  â”‚    currentMode={mode}                          â”‚ â”‚
â”‚  â”‚    onModeChange={setMode}                      â”‚ â”‚
â”‚  â”‚  />                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Messages Display                               â”‚ â”‚
â”‚  â”‚  {messages.map(msg => <Message ... />)}        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Input Area                                     â”‚ â”‚
â”‚  â”‚  <input />                                     â”‚ â”‚
â”‚  â”‚  <button onClick={send}>Send</button>          â”‚ â”‚
â”‚  â”‚                                                â”‚ â”‚
â”‚  â”‚  On send:                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ messages.push(userMessage)                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ fetch('/api/chat/simulation', {            â”‚ â”‚
â”‚  â”‚  â”‚   body: {                                   â”‚ â”‚
â”‚  â”‚  â”‚     messages,                               â”‚ â”‚
â”‚  â”‚  â”‚     mode: currentMode â† IMPORTANT!          â”‚ â”‚
â”‚  â”‚  â”‚   }                                         â”‚ â”‚
â”‚  â”‚  â”‚ })                                          â”‚ â”‚
â”‚  â”‚  â””â”€ stream response into messages              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ Optional: <AssistantModeInfo />  (Help panel)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture supports:
- âœ… Multiple distinct AI personalities
- âœ… Clear separation of concerns
- âœ… Easy to add new modes
- âœ… Production-ready scaling
- âœ… Type-safe implementation
- âœ… Backward compatible
